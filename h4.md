# h4 pkg-file-service

## x) Lue ja tiivistä. (Tässä x-alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen tai kuunteleminen ja tiivistelmä riittää. Tiivistämiseen riittää muutama ranskalainen viiva.)
Karvinen 2018: Pkg-File-Service – Control Daemons with Salt – Change SSH Server Port
-	Pkg-File-Service on tapa hallita daemonia Saltilla: pkg.installed (ohjelma) → file.managed (asetukset) → service.running (käynnissä + watch).
-	watch käynnistää palvelun uudelleen jos asetustiedosto muuttuu.
-	Esimerkkinä sshd-portin vaihto: konfiguraatio salt://sshd_config, palvelu sshd.
-	Tila tehdään masterille ja ajetaan minionille ( --local)

## a) SSHouto. Lisää uusi portti, jossa SSHd kuuntelee.

Käytin tämän tehtävän tekemiseen aiemmassa tehtävässä Vagrantilla tehtyä konetta t001, koska en saanut debianissa suominäppistä toimimaan ja kyllästyin tappelemaan sen kanssa
Otin powershellillä vagrant koneen ylös ja otin ssh yhteyden

<img width="600" height="284" alt="image" src="https://github.com/user-attachments/assets/47a30eb7-88d1-4e00-a5b7-f71cdd9860a4" />

 
Asennetaan ssh

    sudo apt-get update
    sudo apt-get install -y openssh-server
    sudoedit /etc/ssh/sshd_config

<img width="600" height="472" alt="image" src="https://github.com/user-attachments/assets/00913d38-49ad-4053-93ea-c0a23f0412a8" />

 
Varmistetaan rivit Port 22 ja Port 1234
Käynnistetään ssh uudelleen

 <img width="600" height="334" alt="image" src="https://github.com/user-attachments/assets/f05be98d-9532-492c-bf82-c4c58ebe5c1e" />


ja testataan kuunteleeko portit

<img width="600" height="118" alt="image" src="https://github.com/user-attachments/assets/ce134af8-f295-4384-9129-4528969bcfda" />

 
Tomii


    sudo mkdir -p /srv/salt/ssh
    sudo nano /srv/salt/ssh/init.sls

<img width="600" height="494" alt="image" src="https://github.com/user-attachments/assets/64662f2d-f395-4b33-a59c-5c2ee5c976fb" />


    sudo nano /srv/salt/ssh/sshd_config

<img width="600" height="350" alt="image" src="https://github.com/user-attachments/assets/8b37259c-b5e6-4c7f-82b6-b5422eb7af6b" />


Ja testataan

    sudo salt-call --local state.apply ssh

 <img width="500" height="308" alt="image" src="https://github.com/user-attachments/assets/44a2c76e-51f3-4b20-8de1-a9cd87324f48" />
 
<img width="500" height="300" alt="image" src="https://github.com/user-attachments/assets/c7669dab-d4d7-41ac-bf04-429a1ad0865e" />

 
Sitten kun ajoin uudelleen

<img width="500" height="844" alt="image" src="https://github.com/user-attachments/assets/3b64f7d3-906e-4fbe-8e3b-750852771904" />

 
Ei muutoksia eli idempotetntti

Poistetaan ssh

 <img width="600" height="396" alt="image" src="https://github.com/user-attachments/assets/f795a82b-b452-471a-b1dd-5e13b423ae7b" />

<img width="600" height="86" alt="image" src="https://github.com/user-attachments/assets/4ad89237-1e66-4c18-9a6e-4cf67b691746" />

 
Paketti poistettu, tiedostot jäljellä eli ssh on poistettu

Ja sitten ajetaan

    sudo salt-call --local state.apply ssh 
    
Kesti aika tosi kauan

<img width="500" height="52" alt="image" src="https://github.com/user-attachments/assets/423ce2db-6e27-4445-81c8-d739016622c6" />

 
Varmaan sent akia että tuli killed, muisti ei riittänyt. Piti asentaa ssh käsin että pääsen koneeseen takas kiinni.

Kävin lisäämässä VirtualBoxilta Settings → System → Motherboard lisää memoryä niin nyt kokeillaan uudelleen


    sudo apt-get remove -y openssh-server
    dpkg -l | grep openssh-server

<img width="600" height="1144" alt="image" src="https://github.com/user-attachments/assets/1d03340d-1823-440a-8b01-79668e70c680" />

 
Näkyy että paketti on poistettu, ajetaan

    sudo salt-call --local state.apply ssh
    
1 change

<img width="600" height="813" alt="image" src="https://github.com/user-attachments/assets/88a7a78b-1bd4-460b-a5b7-298c92f41048" />

 
Ajetaan uudelleen ja ja 0 changes

## Lähteet:
Pkg-File-Service – Control Daemons with Salt – Change SSH Server Port
https://terokarvinen.com/2018/pkg-file-service-control-daemons-with-salt-change-ssh-server-port/
