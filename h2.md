# h2 Infraa koodina

## x) Lue ja tiivistä. (Tässä x-alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen tai kuunteleminen ja tiivistelmä riittää. Tiivistämiseen riittää muutama ranskalainen viiva.)

•	Saltilla hallitaan ympäristöjä infrana koodina eli asetukset kirjoitetaan tiedostoiksi, joita voi ajaa uudelleen ja tulos pysyy samana.

•	init.sls-tiedostoissa määritellään, mitä ohjelmia, tiedostoja ja palveluja halutaan — ja Salt huolehtii lopusta.

•	YAML on rakenteen kieli: välilyönnit ja sisennykset määräävät kaiken, ei yhtään tabia tai ylimääräistä väliä.

•	Tiedostot koostuvat avain - arvo pareista ja listauksista, joilla kuvataan haluttu tila.

•	 top.sls kertoo, mitkä tilat ajetaan ja mille koneille – vähän kuin “komentokeskus” koko infralle.

•	Kun kaikki on kohdillaan, Salt tekee koneista yhdenmukaisia ja varmistaa, että tila pysyy haluttuna.

## a) Hei infrakoodi! Kokeile paikallisesti (esim 'sudo salt-call --local') infraa koodina. Kirjota sls-tiedosto, joka tekee esimerkkitiedoston /tmp/ -kansioon.

    sudo mkdir /srv/salt/moi
    sudo nano /srv/salt/moi/init.sls

 <img width="600" height="197" alt="image" src="https://github.com/user-attachments/assets/a086a985-2f1b-4bd1-b6b3-1982a9fb9aae" />
 
<img width="600" height="595" alt="image" src="https://github.com/user-attachments/assets/ff45cff2-dd1a-47d3-9f74-0452828d8821" />

<img width="400" height="61" alt="image" src="https://github.com/user-attachments/assets/14a7fbc7-19dc-4266-9eae-655a98431a4c" />


 
Tein hakemiston /srv/salt/moi ja sinne init.sls-tiedoston, joka loi tekstitiedoston /tmp-kansioon.

## b) Toppping. Tee top-file, niin että kaikki omat tilasi ajetaan kerralla komennolla 'sudo salt-call --local state.apply'.

    sudo nano /srv/salt/top.sls

Tein top.file:n jolla määritetään mitkä kaikki tilat ajetaan sudo salt-call –local state.apply

 <img width="600" height="273" alt="image" src="https://github.com/user-attachments/assets/480d5fbc-40f4-4343-884e-21838deb3c0a" />
 

Tämä ei tokikaan vielä toimi jos nyt kokeilee ajaa koska init. tiedostot puuttuvat

## c) Viisikko tiedostossa. Tee erilliset esimerkit kustakin viidestä tärkeimmästä tilafunktiosta pkg, file, service, user, cmd. Kirjoita esimerkit omiksi tiloikseen /srv/salt/ alle, esim /srv/salt/hellopkg/init.sls.

 <img width="300" height="33" alt="image" src="https://github.com/user-attachments/assets/da2d3619-e80f-4e1d-a390-c5b60200ccd8" />

 
Loin hakemistot kaikille tiloille
 
 <img width="600" height="34" alt="image" src="https://github.com/user-attachments/assets/62adf99c-279d-4590-acc4-42e3d794f9a4" />

 <img width="600" height="273" alt="image" src="https://github.com/user-attachments/assets/1bfca56c-4fde-40fd-a2af-6c6e73046a70" />

<img width="600" height="31" alt="image" src="https://github.com/user-attachments/assets/18628d5b-ff16-4e52-8000-4851086ae68f" />

<img width="600" height="203" alt="image" src="https://github.com/user-attachments/assets/ed1ffdcd-2cd2-4324-8b8e-2699ab3dd49c" />

 <img width="600" height="34" alt="image" src="https://github.com/user-attachments/assets/9152a1ca-07b7-46f3-b090-aeb0712ba38b" />

 <img width="600" height="183" alt="image" src="https://github.com/user-attachments/assets/e58d4c20-0a02-4cbf-8d2c-99cbb7470fb8" />

 <img width="600" height="36" alt="image" src="https://github.com/user-attachments/assets/74b436f0-d17d-4e49-b650-2cccbac8484e" />

 <img width="600" height="244" alt="image" src="https://github.com/user-attachments/assets/d67ef303-fe07-4848-812b-1bfb062dc3f4" />
 
<img width="600" height="38" alt="image" src="https://github.com/user-attachments/assets/14ecd8af-8a70-4e1a-9c66-ecb700526758" />

 <img width="600" height="166" alt="image" src="https://github.com/user-attachments/assets/f2c58c9c-7bcc-4b89-9a1c-f4af43d1ccd9" />

  Ja lisäsin init tiedostot hakemistoihin

Aoin komennon

     sudo salt-call –local state.apply

 
<img width="600" height="1071" alt="image" src="https://github.com/user-attachments/assets/50a5f9ed-cf37-4f75-8c4d-a28ceb664331" />


 <img width="600" height="475" alt="image" src="https://github.com/user-attachments/assets/6a01982f-523f-412d-aef2-1e4a16955ea2" />


<img width="600" height="484" alt="image" src="https://github.com/user-attachments/assets/1651c28d-bc5b-440f-aafa-a2a27b2778fc" />

 
<img width="600" height="566" alt="image" src="https://github.com/user-attachments/assets/d691eeb0-bf89-4955-9bcb-6fc81e4e81c4" />

 <img width="600" height="1045" alt="image" src="https://github.com/user-attachments/assets/bbdaf0d1-8173-4e2f-b567-5cb0d66921c4" />

<img width="600" height="1062" alt="image" src="https://github.com/user-attachments/assets/92bdbc7b-973b-478c-89c7-3b36808d8f23" />
 
 
<img width="600" height="225" alt="image" src="https://github.com/user-attachments/assets/cc648bbb-737c-40fa-aeb1-2c8522e19e10" />

 <img width="500" height="59" alt="image" src="https://github.com/user-attachments/assets/6f2e85e3-85e2-410e-ab3b-9e69457a0c35" />

  
Tarkistin vielä että tekstitiedosto ja sen sisältämä teksti löytyy

## d) Tee sls-tiedosto, joka käyttää vähintään kahta eri tilafunktiota näistä: package, file, service, user. Tarkista eri ohjelmalla, että lopputulos on oikea. Osoita useammalla ajolla, että sls-tiedostosi on idempotentti.

 <img width="600" height="36" alt="image" src="https://github.com/user-attachments/assets/f5d6183c-7ae1-4574-8d1d-19ae5f9262ff" />

Aloitin tekemällä hakemiston yhdistelmä ajoa varten ja loin sinne inint.sls

 <img width="600" height="919" alt="image" src="https://github.com/user-attachments/assets/0e34440d-1758-4747-877c-975b465cee92" />

1.	Luo käyttäjän teppo.
2.	Asentaa Apache2-palvelimen.
3.	Luo etusivun tiedoston, johon kirjoitetaan oma tervehdys.
4.	Käynnistää ja varmistaa, että Apache-palvelin toimii.

 <img width="500" height="38" alt="image" src="https://github.com/user-attachments/assets/2ebbcedf-d968-42da-a29a-aa783e8b3404" />

Ajoin komennon

 <img width="400" height="220" alt="image" src="https://github.com/user-attachments/assets/c1b5eeac-4d84-4509-b5b2-c59cc9421a57" />

Ja 4 tilaa ajettiin

<img width="600" height="1036" alt="image" src="https://github.com/user-attachments/assets/65a6fd2e-e90e-4ef6-8b3f-bb5a06908df8" />

 
Ajoin kaksi kertaa uudelleen 4 tilaa ja molemmilla kerroilla changes 0 joten idempotenttiduus näkyy siinä

## Lähteet:

https://terokarvinen.com/2024/hello-salt-infra-as-code/
https://docs.saltproject.io/salt/user-guide/en/latest/topics/overview.html#rules-of-yaml
https://docs.saltproject.io/en/latest/ref/states/top.html
