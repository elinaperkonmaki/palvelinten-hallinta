## h2 Soitto kotiin

### x) Lue ja tiivistä

### Karvinen 2021: Two Machine Virtual Network With Debian
•	Tässä tehdään kahden virtuaalikoneen verkko Vagrantilla ja VirtualBoxilla.
•	Koneille annetaan nimet ja IP-osoitteet Vagrantfileen.
•	Testataan, että koneet näkevät toisensa ping-komennolla.


### Karvinen 2018: Salt Quickstart – Salt Stack Master and Slave
•	Tässä käydään läpi miten Saltin toimintaperiaate master “herra” ja minionit “orjia”.
•	Masterilta lähetetään komentoja ja minionit toteuttavat ne.
•	Koneet käyttävät avaimia tunnistukseen
•	Saltilla voi hallita monta konetta kerralla yhdestä paikasta, esim. sudo salt '*' cmd.run 'hostname'


### Karvinen 2023: Salt Vagrant – automatically provision one master and two slaves
•	Tässä idea Infra as Code eli haluttu järjestelmän tila kirjoitetaan tiedostoon ja Salt tekee sen automaattisesti
•	init.sls kuvaa mitä koneelle pitää tulla (esim. tiedosto tai ohjelma).
•	top.sls määrittää, mitkä tilat ajetaan milläkin koneella, esimerkiksi kaikille minioneille sama tila.



a) Hello Vagrant! Osoita jollain komennolla, että Vagrant on asennettu (esim tulostaa vagrantin versionumeron). Jos et ole vielä asentanut niitä, raportoi myös Vagrant ja VirtualBox asennukset. (Jos Vagrant ja VirtualBox on jo asennettu, niiden asennusta ei tarvitse tehdä eikä raportoida uudelleen.)
Aloitin asentamalla Vagrantin, VirtualBox oli jo asennettu

<img width="448" height="53" alt="image" src="https://github.com/user-attachments/assets/4d76734a-c10c-438e-ae33-5e241a9536b1" />


 
b) Linux Vagrant. Tee Vagrantilla uusi Linux-virtuaalikone.
 
 <img width="925" height="500" alt="image" src="https://github.com/user-attachments/assets/75eb46b8-a267-4124-94dd-09b25d689421" />


<img width="1004" height="307" alt="image" src="https://github.com/user-attachments/assets/86ccab18-91d3-4f26-8021-8568ce15f0e6" />


<img width="634" height="92" alt="image" src="https://github.com/user-attachments/assets/3608123f-902b-4eba-a25e-5f42090ca3d0" />


<img width="1004" height="457" alt="image" src="https://github.com/user-attachments/assets/a7cc064f-2ef2-4eef-bb24-9ef4365c8c68" />


c) Kaksin kaunihimpi. Tee kahden Linux-tietokoneen verkko Vagrantilla. Osoita, että koneet voivat pingata toisiaan.

Aloitin tekemällä kansion kahdelle virtuaalikoneelle


<img width="823" height="409" alt="image" src="https://github.com/user-attachments/assets/37f07334-5d0d-4af0-8ba5-24c151eb61ff" />

 
 Loin Vagrantfilen
 

 <img width="802" height="497" alt="image" src="https://github.com/user-attachments/assets/708bb7a4-7815-4d1d-8d13-16ae3bda93b9" />

 
Käynnistin


<img width="1004" height="136" alt="image" src="https://github.com/user-attachments/assets/5fbf5158-d5e0-4f5c-a220-1de976695f46" />

 
En tiedä oliko ääkköset tässä sotkemassa, mutten tuhrannut tähän enempää aikaa. Avasin uuden powershellin ja tein kansion vagrant_h2 tehtävää varten C:n juureen


<img width="989" height="500" alt="image" src="https://github.com/user-attachments/assets/5fadf951-4fe7-413c-9bdf-ce2088eb4516" />


Loin uudelleen Vagrantfilen ja koitin käynnistää. Näytti aluksi nousevan hyvin mutta, eipä toiminut niin kuin piti, johtuneeko siitä etten ollut poistanut edellistä virtuaalikonetta. Joten ensin tuhoamaan se


<img width="608" height="91" alt="image" src="https://github.com/user-attachments/assets/5045d483-e2b9-4c13-a832-193d209fa6cd" />

 
Poistettu ja uusi yritys


<img width="1004" height="417" alt="image" src="https://github.com/user-attachments/assets/df411c33-bb41-46c4-904e-04144f122899" />

 
Ja sieltähän ne molemmat pompahti


<img width="645" height="184" alt="image" src="https://github.com/user-attachments/assets/b7360541-08a2-441e-88c7-0c4d2ef9a58d" />

 
ping toimi molemmin päin

 
<img width="805" height="177" alt="image" src="https://github.com/user-attachments/assets/1e997363-084b-4a45-a049-d40b67c963b5" />


<img width="781" height="178" alt="image" src="https://github.com/user-attachments/assets/ac05489f-effb-4f9e-abde-99207c6dd7c6" />


d) Herra-orja verkossa. Demonstroi Salt herra-orja arkkitehtuurin toimintaa kahden Linux-koneen verkossa, jonka teit Vagrantilla. Asenna toiselle koneelle salt-master, toiselle salt-minion. Laita orjan /etc/salt/minion -tiedostoon masterin osoite. Hyväksy avain ja osoita, että herra voi komentaa orjakonetta.

Salt Masterin asennus ei onnistunut kerta heitolla


<img width="694" height="131" alt="image" src="https://github.com/user-attachments/assets/60a53582-618b-4561-a3cd-c38bf66729c0" />

 
Muistin että h1 tehtävässä oli sama ongelma ja päätin kokeilla samaa ratkaisua tähän ja seurata ohjetta: https://docs.saltproject.io/salt/install-guide/en/latest/topics/install-by-operating-system/linux-deb.html


sudo mkdir -p /etc/apt/keyrings
sudo apt update
sudo apt install curl
curl -fsSL https://packages.broadcom.com/artifactory/api/security/keypair/SaltProjectKey/public | sudo tee /etc/apt/keyrings/salt-archive-keyring.pgp
curl -fsSL https://github.com/saltstack/salt-install-guide/releases/latest/download/salt.sources | sudo tee /etc/apt/sources.list.d/salt.sources
sudo apt update
sudo apt-get install salt-minion -y

ja masterille muuten samat, mutta
sudo apt-get install salt-master -y

Otin ssh yhteyden t002 eli minioniin ja lisäsin masterin ip:n 
sudoedit /etc/salt/minion
sudo systemctl restart salt-minion


Ja takaisin masteriin

 
<img width="591" height="134" alt="image" src="https://github.com/user-attachments/assets/bc606168-26d9-42dd-97f9-562277251a89" />


Avain hyväksytty
 
 
Ja minion kuuntelee masteria


<img width="517" height="98" alt="image" src="https://github.com/user-attachments/assets/51671eda-227d-4cbf-bbdb-86e0f9aef977" />


<img width="833" height="217" alt="image" src="https://github.com/user-attachments/assets/cc518de6-7426-4baf-a6fc-41fc4120ee11" />


e) Kokeile vähintään kahta tilaa verkon yli (viisikosta: pkg, file, service, user, cmd)


Testasin Saltin tiloja Karvisen (2023) ohjeen mukaan.
Masterilla (t001) loin hakemiston /srv/salt/hello ja tein tiedoston init.sls joka loi minionille tiedoston /tmp/infra-as-code 
Ajoin tilan masterilla

sudo salt '*' state.apply
Salt ilmoitti että tila suoritettiin onnistuneesti
Minionilla (t002) tarkistin tuloksen komennolla
cat /tmp/infra-as-code


<img width="1004" height="493" alt="image" src="https://github.com/user-attachments/assets/cf875ccd-45aa-4977-b5e4-405ff10890d0" />

 

Testasin pkg-tilaa asentamalla htop-paketin verkon yli komennolla
sudo salt '*' state.single pkg.installed htop
Salt antoi virheilmoituksen


<img width="1004" height="540" alt="image" src="https://github.com/user-attachments/assets/608784c4-c55e-44e4-9323-36a9df2ce832" />


 
Tämä johtunee siitä että minionin kellonaika oli jäljessä
Vaikka asennus ei onnistunut, tämä osoitti silti, että pkg-tila toimi oikein ja master pystyi lähettämään komennon minionille ja sai siltä virheilmoituksen verkon yli

Testasin lisäksi cmd-tilaa
sudo salt '*' cmd.run 'uptime'
Salt palautti minionin käynnissäoloajan


 <img width="833" height="89" alt="image" src="https://github.com/user-attachments/assets/f8a40a9e-f21d-4279-9183-416bc99aab79" />


Lähteet:
https://terokarvinen.com/palvelinten-hallinta/#h2-soitto-kotiin https://terokarvinen.com/2021/two-machine-virtual-network-with-debian-11-bullseye-and-vagrant/
https://terokarvinen.com/2018/salt-quickstart-salt-stack-master-and-slave-on-ubuntu-linux/?fromSearch=salt%20quickstart%20salt%20stack%20master%20and%20slave%20on%20ubuntu%20linux
https://terokarvinen.com/2023/salt-vagrant/#infra-as-code---your-wishes-as-a-text-file
https://developer.hashicorp.com/vagrant/docs/installation
https://docs.saltproject.io/salt/install-guide/en/latest/topics/install-by-operating-system/linux-deb.html


